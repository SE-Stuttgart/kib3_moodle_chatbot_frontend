{{> core_h5p/h5presize }}

<!-- Configuration -->
<div>
    <button data-action="block_chatbot/settings" class="btn" data-toggle="modal" data-target="#block_chatbot_settingsModal">
        Einstellungen
        <svg xmlns="http://www.w3.org/2000/svg" height="16" width="16" viewBox="0 0 512 512">
            <!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.-->
            <path d="M495.9 166.6c3.2 8.7 .5 18.4-6.4 24.6l-43.3 39.4c1.1 8.3 1.7 16.8 1.7 25.4s-.6 17.1-1.7 25.4l43.3 39.4c6.9 6.2 9.6 15.9 6.4 24.6c-4.4 11.9-9.7 23.3-15.8 34.3l-4.7 8.1c-6.6 11-14 21.4-22.1 31.2c-5.9 7.2-15.7 9.6-24.5 6.8l-55.7-17.7c-13.4 10.3-28.2 18.9-44 25.4l-12.5 57.1c-2 9.1-9 16.3-18.2 17.8c-13.8 2.3-28 3.5-42.5 3.5s-28.7-1.2-42.5-3.5c-9.2-1.5-16.2-8.7-18.2-17.8l-12.5-57.1c-15.8-6.5-30.6-15.1-44-25.4L83.1 425.9c-8.8 2.8-18.6 .3-24.5-6.8c-8.1-9.8-15.5-20.2-22.1-31.2l-4.7-8.1c-6.1-11-11.4-22.4-15.8-34.3c-3.2-8.7-.5-18.4 6.4-24.6l43.3-39.4C64.6 273.1 64 264.6 64 256s.6-17.1 1.7-25.4L22.4 191.2c-6.9-6.2-9.6-15.9-6.4-24.6c4.4-11.9 9.7-23.3 15.8-34.3l4.7-8.1c6.6-11 14-21.4 22.1-31.2c5.9-7.2 15.7-9.6 24.5-6.8l55.7 17.7c13.4-10.3 28.2-18.9 44-25.4l12.5-57.1c2-9.1 9-16.3 18.2-17.8C227.3 1.2 241.5 0 256 0s28.7 1.2 42.5 3.5c9.2 1.5 16.2 8.7 18.2 17.8l12.5 57.1c15.8 6.5 30.6 15.1 44 25.4l55.7-17.7c8.8-2.8 18.6-.3 24.5 6.8c8.1 9.8 15.5 20.2 22.1 31.2l4.7 8.1c6.1 11 11.4 22.4 15.8 34.3zM256 336a80 80 0 1 0 0-160 80 80 0 1 0 0 160z"/>
        </svg>
    </button>
</div>

<!-- Course module modal view -->
<div class="modal moodle-has-zindex embed_cm_modal" id="block_chatbot_coursemoduleview" tabindex="-1" role="dialog" aria-labelledby="block_chatbot_coursemodulview" aria-hidden="true" data-region="modal-container">
    <div class="modal-dialog modal-dialog-scrollable modal-lg" data-region="modal" tabindex="0" style="max-width: 1100px;">
        <div class="modal-content">
            <div class="modal-header " data-region="header">
                <h5 id="block_chatbot_coursemoduleview_title" class="modal-title" data-region="title"></h5>
                <button type="button" class="close ml-2" data-action="hide" aria-label="Close" data-dismiss="modal">
                    <span aria-hidden="true">×</span>
                </button>
            </div>
            <div class="modal-body resourceobject" data-region="body" style="min-height: 741px;" width="100%" height="741">
                <iframe id="block_chatbot_coursemoduleview_iframe" src="" width="100%" height="100%">
                </iframe>
            </div>
        </div>
    </div>
</div>


                    
            

<!-- Settings Modal -->
<div class="modal fade" id="block_chatbot_settingsModal" tabindex="-1" role="dialog" aria-labelledby="block_chatbot_settingsModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="block_chatbot_settingsModalLabel">Chatbot Einstellungen</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <!-- Settings form -->
                <form id="block_chatbot_settingsForm">
                    <div class="row mb-1">
                        <label class="col-sm-8 col-form-label" for="block_chatbot_enabled">Aktiv:</label>
                        <div class="col-sm-3">
                            <input class="form-control" type="checkbox" id="block_chatbot_enabled">
                        </div>
                    </div>
                    <div class="row mb-1">
                        <label class="col-sm-8 col-form-label" for="block_chatbot_logging">Logging:</label>
                        <div class="col-sm-3">
                            <input class="form-control" type="checkbox" id="block_chatbot_logging">
                        </div>
                    </div>
                    <div class="row mb-1">
                        <label class="col-sm-8 col-form-label" for="block_chatbot_openonlogin">Öffne bei Login:</label>
                        <div class="col-sm-3">
                            <input class="form-control" type="checkbox" id="block_chatbot_openonlogin">
                        </div>
                    </div>
                    <div class="row mb-1">
                        <label class="col-sm-8 col-form-label" for="block_chatbot_openonquiz">Öffne nach Quiz:</label>
                        <div class="col-sm-3">
                            <input class="form-control" type="checkbox" id="block_chatbot_openonquiz">
                        </div>
                    </div>
                    <div class="row mb-1">
                        <label class="col-sm-8 col-form-label" for="block_chatbot_openonsection">Öffne nach Abschnitt:</label>
                        <div class="col-sm-3">
                            <input class="form-control" type="checkbox" id="block_chatbot_openonsection">
                        </div>
                    </div>
                    <div class="row mb-1">
                        <label class="col-sm-8 col-form-label" for="block_chatbot_openonbranch">Öffne nach Themenzweig:</label>
                        <div class="col-sm-3">
                            <input class="form-control" type="checkbox" id="block_chatbot_openonbranch">
                        </div>
                    </div>
                    <div class="row mb-1">
                        <label class="col-sm-8 col-form-label" for="block_chatbot_openonbadge">Öffne bei Badge:</label>
                        <div class="col-sm-3">
                            <input class="form-control" type="checkbox" id="block_chatbot_openonbadge">
                        </div>
                    </div>
                    <div class="row mb-1">
                        <label class="col-sm-8 col-form-label" for="block_chatbot_numreviewquizzes">Anzahl Quizzes pro Wiederholungsrunde:</label>
                        <div class="col-sm-3">
                            <input class="form-control" type="number" id="block_chatbot_numreviewquizzes" value="3" min="1" max="25" onchange="this.value = Math.min(Math.abs(this.value), 25)"">
                        </div>
                    </div>
                    <div class="row mb-1">
                        <label class="col-sm-8 col-form-label" for="block_chatbot_numsearchresults">Anzahl Suchergebnisse:</label>
                        <div class="col-sm-3">
                            <input class="form-control" type="number" id="block_chatbot_numsearchresults" value="3" min="1" max="25" onchange="this.value = Math.min(Math.abs(this.value), 25)">
                        </div>
                    </div>
                    <fieldset class="row mb-1">
                        <legend class="col-form-label col-sm-10 pt-0">Bevorzugter Inhaltstyp:</legend>
                        <div class="col-sm-10">
                            <div class="form-check">
                                <input class="form-check-input" type="radio" id="block_chatbot_preferedcontenttype_url" type="radio" name="block_chatbot_radio_contenttype" value="url">
                                <label class="form-check-label" for="block_chatbot_preferedcontenttype_url">Video</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" id="block_chatbot_preferedcontenttype_book" type="radio" name="block_chatbot_radio_contenttype" value="book">
                                <label class="form-check-label" for="block_chatbot_preferedcontenttype_book">Buch</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" id="block_chatbot_preferedcontenttype_resource" type="radio" name="block_chatbot_radio_contenttype" value="resource">
                                <label class="form-check-label" for="block_chatbot_preferedcontenttype_resource">PDF-Datei<label>
                            </div>
                        </div>
                    </fieldset>
                    <button type="submit" class="btn btn-primary" data-action="block_chatbot/saveSettings" data-dismiss="modal">Speichern</button>
                </form> 
            </div>
        </div>
    </div>
</div>


<!-- Chatbot window -->
{{#enabled}}
    <div id="block_chatbot-chatwindow" class="block_chatbot-chatwindow">
        <!-- Minimized version -->
        <div class="block_chatbot-headerMinimized">
            <button data-action="block_chatbot/toggleWindowState" class="block_chatbot-maximizeButton">
                <svg fill="white" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" 
                        viewBox="0 0 60 60" xml:space="preserve">
                    <g>
                        <path d="M42,15.5H5.93C2.66,15.5,0,18.16,0,21.429V42.57c0,3.27,2.66,5.93,5.93,5.93H12v10c0,0.413,0.254,0.784,0.64,0.933
                            C12.757,59.478,12.879,59.5,13,59.5c0.276,0,0.547-0.115,0.74-0.327L23.442,48.5H42c3.27,0,5.93-2.66,5.93-5.929V21.43
                            C47.93,18.16,45.27,15.5,42,15.5z"/>
                        <path d="M54.072,0.57L19.93,0.5C16.66,0.5,14,3.16,14,6.43v6.122c0,0.266,0.105,0.52,0.293,0.708
                            c0.188,0.187,0.442,0.292,0.707,0.292c0,0,0.001,0,0.002,0L40.07,13.5c8.951,0,9.93,2.021,9.93,7.93v21.141
                            c0,0.091-0.01,0.181-0.014,0.271l1.274,1.401c0.193,0.212,0.463,0.327,0.74,0.327c0.121,0,0.243-0.022,0.361-0.067
                            C52.746,44.354,53,43.983,53,43.57v-10h1.07c3.27,0,5.93-2.66,5.93-5.929V6.5C60,3.23,57.34,0.57,54.072,0.57z"/>
                    </g>
                </svg>
            </button>
        </div>

        <!-- Maximized version -->
        <div id="block_chatbot-chatwindowInner" class="block_chatbot-chatwindowInner block_chatbot-default">
            <div class="block_chatbot-headerMaximized">
                <div class="block_chatbot-header_text"><b>Moodle-Assistent</b></div>
                <button data-action="block_chatbot/help" class="block_chatbot-headerButton">
                    <svg xmlns="http://www.w3.org/2000/svg" height="16" width="16" viewBox="0 0 512 512">
                        <!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.-->
                        <path d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM169.8 165.3c7.9-22.3 29.1-37.3 52.8-37.3h58.3c34.9 0 63.1 28.3 63.1 63.1c0 22.6-12.1 43.5-31.7 54.8L280 264.4c-.2 13-10.9 23.6-24 23.6c-13.3 0-24-10.7-24-24V250.5c0-8.6 4.6-16.5 12.1-20.8l44.3-25.4c4.7-2.7 7.6-7.7 7.6-13.1c0-8.4-6.8-15.1-15.1-15.1H222.6c-3.4 0-6.4 2.1-7.5 5.3l-.4 1.2c-4.4 12.5-18.2 19-30.6 14.6s-19-18.2-14.6-30.6l.4-1.2zM224 352a32 32 0 1 1 64 0 32 32 0 1 1 -64 0z"/>
                    </svg>
                </button>
                <button data-action="block_chatbot/settings" class="block_chatbot-headerButton" data-toggle="modal" data-target="#block_chatbot_settingsModal">
                    <svg xmlns="http://www.w3.org/2000/svg" height="16" width="16" viewBox="0 0 512 512">
                        <!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.-->
                        <path d="M495.9 166.6c3.2 8.7 .5 18.4-6.4 24.6l-43.3 39.4c1.1 8.3 1.7 16.8 1.7 25.4s-.6 17.1-1.7 25.4l43.3 39.4c6.9 6.2 9.6 15.9 6.4 24.6c-4.4 11.9-9.7 23.3-15.8 34.3l-4.7 8.1c-6.6 11-14 21.4-22.1 31.2c-5.9 7.2-15.7 9.6-24.5 6.8l-55.7-17.7c-13.4 10.3-28.2 18.9-44 25.4l-12.5 57.1c-2 9.1-9 16.3-18.2 17.8c-13.8 2.3-28 3.5-42.5 3.5s-28.7-1.2-42.5-3.5c-9.2-1.5-16.2-8.7-18.2-17.8l-12.5-57.1c-15.8-6.5-30.6-15.1-44-25.4L83.1 425.9c-8.8 2.8-18.6 .3-24.5-6.8c-8.1-9.8-15.5-20.2-22.1-31.2l-4.7-8.1c-6.1-11-11.4-22.4-15.8-34.3c-3.2-8.7-.5-18.4 6.4-24.6l43.3-39.4C64.6 273.1 64 264.6 64 256s.6-17.1 1.7-25.4L22.4 191.2c-6.9-6.2-9.6-15.9-6.4-24.6c4.4-11.9 9.7-23.3 15.8-34.3l4.7-8.1c6.6-11 14-21.4 22.1-31.2c5.9-7.2 15.7-9.6 24.5-6.8l55.7 17.7c13.4-10.3 28.2-18.9 44-25.4l12.5-57.1c2-9.1 9-16.3 18.2-17.8C227.3 1.2 241.5 0 256 0s28.7 1.2 42.5 3.5c9.2 1.5 16.2 8.7 18.2 17.8l12.5 57.1c15.8 6.5 30.6 15.1 44 25.4l55.7-17.7c8.8-2.8 18.6-.3 24.5 6.8c8.1 9.8 15.5 20.2 22.1 31.2l4.7 8.1c6.1 11 11.4 22.4 15.8 34.3zM256 336a80 80 0 1 0 0-160 80 80 0 1 0 0 160z"/>
                    </svg>
                </button>
                <button data-action="block_chatbot/toggleWindowSize" class="block_chatbot-headerButton">
                    <svg xmlns="http://www.w3.org/2000/svg" height="16" width="16" viewBox="0 0 512 512">
                        <!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.-->
                        <path d="M344 0H488c13.3 0 24 10.7 24 24V168c0 9.7-5.8 18.5-14.8 22.2s-19.3 1.7-26.2-5.2l-39-39-87 87c-9.4 9.4-24.6 9.4-33.9 0l-32-32c-9.4-9.4-9.4-24.6 0-33.9l87-87L327 41c-6.9-6.9-8.9-17.2-5.2-26.2S334.3 0 344 0zM168 512H24c-13.3 0-24-10.7-24-24V344c0-9.7 5.8-18.5 14.8-22.2s19.3-1.7 26.2 5.2l39 39 87-87c9.4-9.4 24.6-9.4 33.9 0l32 32c9.4 9.4 9.4 24.6 0 33.9l-87 87 39 39c6.9 6.9 8.9 17.2 5.2 26.2s-12.5 14.8-22.2 14.8z"/>
                    </svg>
                </button>
                <button data-action="block_chatbot/toggleWindowState" class="block_chatbot-headerButton">
                    <svg xmlns="http://www.w3.org/2000/svg" height="16" width="16" viewBox="0 150 512 512">
                        <!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.-->
                        <path d="M32 416c-17.7 0-32 14.3-32 32s14.3 32 32 32H480c17.7 0 32-14.3 32-32s-14.3-32-32-32H32z"/>
                    </svg>
                </button>
            </div>
            <div id="block_chatbot-messagelist" class="block_chatbot-messagelist"></div>
            <div class="block_chatbot-inputContainer">
                <input class="block_chatbot-text_input" id="block_chatbot-userUtterance" data-action="block_chatbot/textInput" placeholder="Bitte hier Fragen etc. eingeben"/>
                <button class="block_chatbot-text_send" data-action="block_chatbot/sendMessage">
                    <svg width="100%" height="100%" viewBox="0 0 1476 1080" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
                        <g transform="matrix(1,0,0,1,-481.72,-1034.63)">
                            <g transform="matrix(0.264968,0.964257,-2.90486,0.798226,3459.05,-407.579)">
                                <path d="M1144.86,1031C1013.4,1048.92 634.031,1124.93 634.031,1065.52C634.031,998.539 999.161,625.501 1181.73,625.501C1364.29,625.501 1729.42,998.539 1729.42,1065.52C1729.42,1124.93 1350.05,1048.92 1218.59,1031C1220.52,1029.44 1221.59,1027.74 1221.59,1025.95L1221.59,878.361C1221.59,871.057 1203.73,865.128 1181.73,865.128C1159.72,865.128 1141.86,871.057 1141.86,878.361L1141.86,1025.95C1141.86,1027.74 1142.93,1029.44 1144.86,1031Z" style="fill:white;"/>
                            </g>
                        </g>
                    </svg>
                </button>
            </div>
        </div>
    <div>
{{/enabled}}

<!-- Init code -->
{{^element.frozen}}
{{#js}}
host = window.location.host;
require(['block_chatbot/chatbot', 'https://cdn.plot.ly/plotly-2.27.0.min.js'], function(Chatbot, Plotly) {
    let conn = Chatbot.init("{{enabled}}", "{{server_name}}", "{{server_port}}", "{{wwwroot}}", "{{userid}}", "{{username}}", "{{courseid}}", "{{slidefindertoken}}", "{{wsuserid}}", "{{timestamp}}", Plotly);
});


{{/js}}
{{/element.frozen}}