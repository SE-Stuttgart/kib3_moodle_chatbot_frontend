{"version":3,"file":"settings.min.js","sources":["../../src/local/settings.js"],"sourcesContent":["export const fetchUserSetttings = async (userid, wstoken, wwwroot) => {\n    // Fetch settings\n    const url = wwwroot + '/webservice/rest/server.php';\n    const urlencoded = new URLSearchParams();\n    urlencoded.append(\"wstoken\", wstoken);\n    urlencoded.append(\"moodlewsrestformat\",  \"json\");\n    urlencoded.append(\"wsfunction\", \"block_chatbot_get_usersettings\");\n    urlencoded.append(\"userid\", userid);\n    const response = await fetch(url, {\n            method: \"POST\",\n            headers: {\n                'Content-Type': 'application/x-www-form-urlencoded',\n            },\n            body: urlencoded\n        }\n    );\n    // Parse settings\n    const msgContent = await response.text();\n    // handle moodle debug mode, which appends a <script> tag to the response\n    const settings = JSON.parse(msgContent.replace(/<script[\\s\\S]*?<\\/script>/gi, ''));\n    return settings;\n};\n\nexport const assignUserSettings = (settings) => {\n    document.getElementById(\"block_chatbot_enabled\").checked = settings.enabled;\n    document.getElementById(\"block_chatbot_logging\").checked = settings.logging;\n    document.getElementById(\"block_chatbot_openonlogin\").checked = settings.openonlogin;\n    document.getElementById(\"block_chatbot_openonquiz\").checked = settings.openonquiz;\n    document.getElementById(\"block_chatbot_openonsection\").checked = settings.openonsection;\n    document.getElementById(\"block_chatbot_openonbranch\").checked = settings.openonbranch;\n    document.getElementById(\"block_chatbot_openonbadge\").checked = settings.openonbadge;\n    document.getElementById(\"block_chatbot_numreviewquizzes\").value = settings.numreviewquizzes;\n    document.getElementById(\"block_chatbot_numsearchresults\").value = settings.numsearchresults;\n    new Array(\"resource\", \"url\", \"book\").forEach(content_type => {\n        document.getElementById('block_chatbot_preferedcontenttype_' + content_type).checked =\n             settings.preferedcontenttype == content_type;\n    });\n};\n\nexport const readUserSettings = () => {\n    const preferedcontenttype = new Array(\"resource\", \"url\", \"book\").map(content_type =>\n        document.getElementById('block_chatbot_preferedcontenttype_' + content_type\n        )).filter(el => el.checked)[0].id.replace(\"block_chatbot_preferedcontenttype_\", \"\");\n    return {\n        enabled: document.getElementById(\"block_chatbot_enabled\").checked,\n        logging: document.getElementById(\"block_chatbot_logging\").checked,\n        openonlogin: document.getElementById(\"block_chatbot_openonlogin\").checked,\n        openonquiz: document.getElementById(\"block_chatbot_openonquiz\").checked,\n        openonsection: document.getElementById(\"block_chatbot_openonsection\").checked,\n        openonbranch: document.getElementById(\"block_chatbot_openonbranch\").checked,\n        openonbadge: document.getElementById(\"block_chatbot_openonbadge\").checked,\n        numreviewquizzes: document.getElementById(\"block_chatbot_numreviewquizzes\").value,\n        numsearchresults: document.getElementById(\"block_chatbot_numsearchresults\").value,\n        preferedcontenttype: preferedcontenttype\n    };\n};\n\nexport const saveUserSetttings = async (userid, wstoken, wwwroot, settings) => {\n    // Construct request\n    let url = wwwroot + '/webservice/rest/server.php';\n    const urlencoded = new URLSearchParams();\n    urlencoded.append(\"wstoken\", wstoken);\n    urlencoded.append(\"moodlewsrestformat\",  \"json\");\n    urlencoded.append(\"wsfunction\", \"block_chatbot_set_usersettings\");\n    urlencoded.append(\"userid\", userid);\n    Object.keys(settings).forEach(key =>\n        urlencoded.append(key, typeof settings[key] === \"boolean\"? Number(settings[key]) : settings[key])\n    );\n    const response = await fetch(url, {\n        method: \"POST\",\n        headers: {\n            'Content-Type': 'application/x-www-form-urlencoded',\n        },\n        body: urlencoded\n    }\n    );\n    const msgContent = await response.text();\n    return true;\n};\n"],"names":["async","userid","wstoken","wwwroot","url","urlencoded","URLSearchParams","append","response","fetch","method","headers","body","msgContent","text","JSON","parse","replace","settings","document","getElementById","checked","enabled","logging","openonlogin","openonquiz","openonsection","openonbranch","openonbadge","value","numreviewquizzes","numsearchresults","Array","forEach","content_type","preferedcontenttype","map","filter","el","id","Object","keys","key","Number"],"mappings":"8QAAkCA,MAAOC,OAAQC,QAASC,iBAEhDC,IAAMD,QAAU,8BAChBE,WAAa,IAAIC,gBACvBD,WAAWE,OAAO,UAAWL,SAC7BG,WAAWE,OAAO,qBAAuB,QACzCF,WAAWE,OAAO,aAAc,kCAChCF,WAAWE,OAAO,SAAUN,cACtBO,eAAiBC,MAAML,IAAK,CAC1BM,OAAQ,OACRC,QAAS,gBACW,qCAEpBC,KAAMP,aAIRQ,iBAAmBL,SAASM,cAEjBC,KAAKC,MAAMH,WAAWI,QAAQ,8BAA+B,kCAI/CC,WAC/BC,SAASC,eAAe,yBAAyBC,QAAUH,SAASI,QACpEH,SAASC,eAAe,yBAAyBC,QAAUH,SAASK,QACpEJ,SAASC,eAAe,6BAA6BC,QAAUH,SAASM,YACxEL,SAASC,eAAe,4BAA4BC,QAAUH,SAASO,WACvEN,SAASC,eAAe,+BAA+BC,QAAUH,SAASQ,cAC1EP,SAASC,eAAe,8BAA8BC,QAAUH,SAASS,aACzER,SAASC,eAAe,6BAA6BC,QAAUH,SAASU,YACxET,SAASC,eAAe,kCAAkCS,MAAQX,SAASY,iBAC3EX,SAASC,eAAe,kCAAkCS,MAAQX,SAASa,qBACvEC,MAAM,WAAY,MAAO,QAAQC,SAAQC,eACzCf,SAASC,eAAe,qCAAuCc,cAAcb,QACxEH,SAASiB,qBAAuBD,2CAIb,WACtBC,oBAAsB,IAAIH,MAAM,WAAY,MAAO,QAAQI,KAAIF,cACjEf,SAASC,eAAe,qCAAuCc,gBAC5DG,QAAOC,IAAMA,GAAGjB,UAAS,GAAGkB,GAAGtB,QAAQ,qCAAsC,UAC7E,CACHK,QAASH,SAASC,eAAe,yBAAyBC,QAC1DE,QAASJ,SAASC,eAAe,yBAAyBC,QAC1DG,YAAaL,SAASC,eAAe,6BAA6BC,QAClEI,WAAYN,SAASC,eAAe,4BAA4BC,QAChEK,cAAeP,SAASC,eAAe,+BAA+BC,QACtEM,aAAcR,SAASC,eAAe,8BAA8BC,QACpEO,YAAaT,SAASC,eAAe,6BAA6BC,QAClES,iBAAkBX,SAASC,eAAe,kCAAkCS,MAC5EE,iBAAkBZ,SAASC,eAAe,kCAAkCS,MAC5EM,oBAAqBA,iDAIInC,MAAOC,OAAQC,QAASC,QAASe,gBAE1Dd,IAAMD,QAAU,oCACdE,WAAa,IAAIC,gBACvBD,WAAWE,OAAO,UAAWL,SAC7BG,WAAWE,OAAO,qBAAuB,QACzCF,WAAWE,OAAO,aAAc,kCAChCF,WAAWE,OAAO,SAAUN,QAC5BuC,OAAOC,KAAKvB,UAAUe,SAAQS,KAC1BrC,WAAWE,OAAOmC,IAA8B,kBAAlBxB,SAASwB,KAAoBC,OAAOzB,SAASwB,MAAQxB,SAASwB,cAE1FlC,eAAiBC,MAAML,IAAK,CAC9BM,OAAQ,OACRC,QAAS,gBACW,qCAEpBC,KAAMP,mBAGeG,SAASM,cAC3B"}